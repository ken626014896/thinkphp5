<!doctype html>
<html class="no-js">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>UBAS Backstage management</title>
<meta name="description" content="这是一个 index 页面">
<meta name="keywords" content="index">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="renderer" content="webkit">
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="icon" type="image/png" href="assets/i/favicon.png">
<link rel="apple-touch-icon-precomposed" href="assets/i/app-icon72x72@2x.png">
<meta name="apple-mobile-web-app-title" content="Amaze UI" />
    <link rel="stylesheet" href="/static/assets/css/amazeui.min.css"/>
    <link rel="stylesheet" href="/static/assets/css/admin.css">
    <link rel="stylesheet" href="/static/assets/css/myPagination.css">
    <script src="/static/assets/js/jquery.min.js"></script>
    <script src="/static/assets/js/app.js"></script>
</head>

<!--[if lte IE 9]><p class="browsehappy">升级你的浏览器吧！ <a href="http://se.360.cn/" target="_blank">升级浏览器</a>以获得更好的体验！</p><![endif]-->








<body>
<header class="am-topbar admin-header">
  <div class="am-topbar-brand"><img src="/static/assets/i/1.png"></div>

  <div class="am-collapse am-topbar-collapse" id="topbar-collapse">
    <ul class="am-nav am-nav-pills am-topbar-nav admin-header-list">



 <li class="kuanjie">
  
  <a href="/member_list?page=1">会员管理</a>
  <a href="/order_list?page=1">订单管理</a>
  <a href="/commodity_list?page=1">产品管理</a>
     <a href="/loginout">退出</a>
 </li>

      <li class="am-hide-sm-only" style="float: right;"><a href="javascript:;" id="admin-fullscreen"><span class="am-icon-arrows-alt"></span> <span class="admin-fullText">开启全屏</span></a></li>
    </ul>
  </div>
</header>

<div class="am-cf admin-main"> 

<div class="nav-navicon admin-main admin-sidebar">
    
    
    <div class="sideMenu am-icon-dashboard" style="color:#aeb2b7; margin: 10px 0 0 0;"> 欢迎系统管理员：{$username}</div>
    <div class="sideMenu">
      <h3 class="am-icon-flag"><em></em> <a href="#">商品管理</a></h3>
      <ul>
        <li><a href="/commodity_list?page=1">商品列表</a></li>
        <li class="func" dataType='html' dataLink='msn.htm' iconImg='images/msn.gif' ><a href="add_commodity.html">添加新商品</a></li>

        <li><a href="/comment_list?page=1">用户评论</a></li>
      </ul>
      <h3 class="am-icon-cart-plus"><em></em> <a href="#"> 订单管理</a></h3>
      <ul>
        <li><a href="/order_list?page=1">订单列表</a></li>



      </ul>
      <h3 class="am-icon-users"><em></em> <a href="#">会员管理</a></h3>
      <ul>
        <li><a href="/member_list?page=1">会员列表 </a></li>
      </ul>
    </div>
    <!-- sideMenu End --> 
    
    <script type="text/javascript">
			jQuery(".sideMenu").slide({
				titCell:"h3", //鼠标触发对象
				targetCell:"ul", //与titCell一一对应，第n个titCell控制第n个targetCell的显示隐藏
				effect:"slideDown", //targetCell下拉效果
				delayTime:700 , //效果时间
				triggerTime:150, //鼠标延迟触发时间（默认150）
				defaultPlay:true,//默认是否执行效果（默认true）
				returnDefault:true //鼠标从.sideMen移走后返回默认状态（默认false）
				});
		</script> 

    
    
    
    
    
    
    
</div>

<div class=" admin-content">
	
		<div class="daohang">
			<ul>
      <li><button type="button" class="am-btn am-btn-default am-radius am-btn-xs"><a href="index.html"> 首页 </a></button></li>
				
				
			</ul>

       

	
</div>
    <div class="am-popup am-popup-inner" id="my-popup">
        <div class="am-popup-hd">
            <h4 class="am-popup-title"></h4>
            <span data-am-modal-close
                  class="am-close">&times;</span>
        </div>
        <div  style="width:630px;height:480px;overflow-y:scroll; ">

            <div class="fbneirong" >

                <ul class="am-list" >
                    <li><a style="display: block; text-align: center;" >订单信息</a></li>
                    <li><a style="color: black" name="danchu-a">订单号：</a></li>
                    <li><a style="color: black" name="danchu-a">单价：</a></li>
                    <li><a style="color: black" name="danchu-a">商品号：</a></li>
                    <li><a style="color: black" name="danchu-a">商品型号：</a></li>
                    <li><a style="color: black" name="danchu-a">购买数量：</a></li>
                    <li><a style="color: black" name="danchu-a">颜色：</a></li>
                    <li><a style="display: block; text-align: center;" >发货信息</a></li>

                    <li><a style="color: black" name="danchu-a">收货人姓名：</a></li>
                    <li><a style="color: black" name="danchu-a">收货人电话：</a></li>
                    <li><a style="color: black" name="danchu-a">收货地址：</a></li>

                </ul>

            </div>
        </div>

    </div>

<div class="admin-biaogelist">
	
    <div class="listbiaoti am-cf">
      <ul class="am-icon-flag on"> 订单列表</ul>
      
      <dl class="am-icon-home" style="float: right;">当前位置： 首页 > <a href="#">订单列表</a></dl>

      <!--这里打开的是新页面-->

    </div>


    <form class="am-form am-g">
          <table width="100%" class="am-table am-table-bordered am-table-radius am-table-striped am-table-hover">
            <thead>
              <tr class="am-success">
                <th class="table-check"><input name='allcheckbox' type="checkbox" /></th>

                <th class="table-title">订单号</th>
                <th class="table-title">商品id</th>
                <th class="table-type">购买数量</th>
                <th class="table-author am-hide-sm-only">是否发货</th>
                <th class="table-title">用户id</th>
                <th class="table-date am-hide-sm-only">购买日期</th>
                <th width="120px" class="table-set">操作</th>
              </tr>
            </thead>
            <tbody>
            {volist name='array_data' id="vo"}


              <tr>
                  {if condition="$vo.status == 2"}<td></td>

                  {else /} <td><input name='aa-checkbox' type="checkbox"  value="{$vo.order_id}+{$vo.user['user_id']}"/></td>
                  {/if}


                
                <td> {$vo.order_id}</td>
                <td>
                    {$vo.commodity['commodity_id']}

                </td>
                <td>{$vo.count}</td>
                <td >
                    <!--0用户下单，1商家发货，2商家发货-->
                    {switch $vo.status}
                    {case value='1'}<i name="icon{$vo.order_id}" class="am-icon-check am-text-warning"></i>{/case}
                    {case value='2'}<i name="icon{$vo.order_id}" >用户已确认收货</i>{/case}
                    {case value='0'}<i name="icon{$vo.order_id}" class="am-icon-close am-text-primary"></i>{/case}
                    {default /}default
                    {/switch}

                </td>
                  <td class="am-hide-sm-only">{$vo.user['user_id']}</td>
                <td class="am-hide-sm-only">{$vo.create_time}</td>

                   <input type="hidden"  name="{$vo.order_id}" class="am-input-lg" id="add-order_id" value='{$vo.order_id}'>
                   <input type="hidden"  name="{$vo.order_id}" class="am-input-lg" id="add-unit_price" value='{$vo.unit_price}'>
                   <input type="hidden"  name="{$vo.order_id}" class="am-input-lg" id="add-commodity_id" value="{$vo.commodity['commodity_id']}">
                   <input type="hidden"  name="{$vo.order_id}" class="am-input-lg" id="add-bid" value="{$vo.commodity['bid']}">
                   <input type="hidden"  name="{$vo.order_id}" class="am-input-lg" id="add-count" value='{$vo.count}'>
                   <input type="hidden"  name="{$vo.order_id}" class="am-input-lg" id="add-color" value="{$vo.commodity['color']}">
                   <input type="hidden"  name="{$vo.order_id}" class="am-input-lg" id="add-recv_name" value="{$vo.recv_address['recv_name']}">
                   <input type="hidden"  name="{$vo.order_id}" class="am-input-lg" id="add-recv_telphone" value="{$vo.recv_address['recv_telphone']}">
                   <input type="hidden"  name="{$vo.order_id}" class="am-input-lg" id="add-address" value="{$vo.recv_address['address']}">

                  <input type="hidden"  name="status{$vo.order_id}" class="am-input-lg" id="add-status" value="{$vo.status}">
                  <input type="hidden"  name="id{$vo.order_id}" class="am-input-lg" id="add-user_id" value="{$vo.user['user_id']}">


                <td>
                	
                	<div class="am-btn-toolbar">
                    <div class="am-btn-group am-btn-group-xs">
                      <a  title="详细订单" id="a-{$vo.order_id}" type="button" data-am-modal="{target: '#my-popup'}" name="opbtn" class="am-btn am-btn-default am-btn-xs am-text-success am-round"><span class="am-icon-search"></span> </a>
                        {switch $vo.status}
                        {case value='0'} <a class="am-btn am-btn-default am-btn-xs am-text-secondary am-round"   id="b-{$vo.order_id}" name="opbtn" title="已发货">发货</a>{/case}
                        {case value='1'} <a class="am-btn am-btn-default am-btn-xs am-text-secondary am-round"  id="b-{$vo.order_id}" name="opbtn" title="确认发货">已发货</a>{/case}
                        {case value='2'} <a class="am-btn  am-btn-xs am-text-secondary am-round"  id="b-{$vo.order_id}" name="opbtn" title="确认发货">   </a>{/case}
                        {default /}default
                        {/switch}
                    </div>
                  </div>
                
                </td>
              </tr>

            {/volist}
            </tbody>
          </table>
          
                 <div class="am-btn-group am-btn-group-xs">

              <a type="button" name='all-send' class="am-btn am-btn-default"><span class="am-icon-save"></span> 确认发货</a>

            </div>
          

          <hr />
<!--           <p>注：.....</p> -->
        </form>


    <div id="pagination" class="pagination"></div>
 
 <div class="foods">
 <!--  <ul>
    版权所有@2015
  </ul> -->
  <dl>
    <a href="" title="返回头部" class="am-icon-btn am-icon-arrow-up"></a>
  </dl>
</div>




</div>

</div>




</div>
<!--[if lt IE 9]>
<script src="http://libs.baidu.com/jquery/1.11.1/jquery.min.js"></script>
<script src="http://cdn.staticfile.org/modernizr/2.8.3/modernizr.js"></script>
<script src="/static/assets/js/polyfill/rem.min.js"></script>
<script src="/static/assets/js/polyfill/respond.min.js"></script>
<script src="/static/assets/js/amazeui.legacy.js"></script>
<script src="/static/assets/js/myPagination.js"></script>
<![endif]-->

<!--[if (gte IE 9)|!(IE)]><!-->
<script src="/static/assets/js/amazeui.min.js"></script>
<script src="/static/assets/js/myPagination.js"></script>
<!--<![endif]-->


</body>
 <script>
     $('document').ready(function () {
         var sum=parseInt({$order_sum})
         //分页
         if(sum<20)
             page_num=1
         else
             page_num=sum %20;

         var str=location.href

         var page_cur=str.split('?')[1].split('=')[1] //当前页面

         new Page({
             id: 'pagination',
             pageTotal: page_num, //必填,总页数
             pageAmount: 10,  //每页多少条
             dataTotal: 500, //总共多少条数据
             curPage:parseInt(page_cur), //初始页码,不填默认为1
             pageSize: 5, //分页个数,不填默认为5
             showPageTotalFlag:false, //是否显示数据统计,不填默认不显示
             showSkipInputFlag:true, //是否支持跳转,不填默认不显示
             getPage: function (page) {
                 //获取当前页数
                 console.log(page);

                 window.location.href='http://localhost:801/order_list?page='+ page
             }
         })


         var moren=[]
         $("a[name='danchu-a']").each(function(){
             moren.push($(this).text())
         })

         //全选
         $("input[name='allcheckbox']").click(function () {

             var  allcheckbox_obj=$(this)
             if(allcheckbox_obj.is(":checked"))
             {

                 $("input[name='aa-checkbox']").each(function(){

                     $(this).prop("checked", true);

                 })

             }

             else
             {

                 $("input[name='aa-checkbox']").each(function(){

                     $(this).prop("checked", false);


                 })

             }
         })

         //发货所选的全部
         $("a[name='all-send']").click(function () {

             var obj=$("input[name='aa-checkbox']")


             for ( k in obj) {
                 if(obj[k].checked){

                     var arr=obj[k].value.split("+");
                     //arr[0]是订单id   //arr[1]是用户id
                     var order_id=arr[0]
                     Sendgoods(order_id)
                 }


             }
             alert('所选的以全部发货')


         })

         // 分发点击事件
         $("a[name='opbtn']").click(function () {

             var btn_id=$(this).attr('id')
             var order_id=btn_id.split('-')
             switch(order_id[0])
             {

                 case 'a'://预览

                     Preview(order_id[1])
                     break;
                 case 'b'://发货
                     Sendgoods(order_id[1])
                     break;

                 default:
                     console.log('出错')
             }

         })

        //预览订单信息
         function Preview(order_id) {
               var p_data=[]

             $("input[name="+order_id+"]").each(function () {

                   p_data.push($(this).val())
             })
             $("a[name='danchu-a']").each(function(){
                 $(this).text('')
             })
             var temp=0
             $("a[name='danchu-a']").each(function(){

                 var new_data=moren[temp]+p_data[temp]
                 $(this).text(new_data)
                 temp=temp+1
                 // a_obj.push($(this))
             })


         }
         //确认发货
         function Sendgoods(order_id) {
             var status_hint_name='status'+order_id
             var status_num=$("input[name="+status_hint_name+"]").val()

             var user_id_name='id'+order_id
             var user_id=$("input[name="+user_id_name+"]").val()


             if(status_num=='1'){


                console.log('已经发货')

             }

             else
             {
                 var str=location.href

                 var page_str=str.split('?')[1]

                 $.ajax({
                     url:'/order_list?'+page_str,
                     type:'POST',
                     data:{order_id:order_id,user_id:user_id},
                     success:function(databack){


                         var input_obj=$("input[name="+status_hint_name+"]")

                         var  a_name='icon'+order_id
                         var a_obj=$("i[name="+a_name+"]")
                         var btn_id='b-'+order_id

                         var btn_obj=$("#"+btn_id)

                         if(databack=='true')
                         {
                             a_obj.attr("class","am-icon-check am-text-warning");
                             btn_obj.attr('title','已发货')
                             btn_obj.text('已发货')
                             input_obj.val('1')

                         }

                     }

                 })
             }




         }



     })

 </script>
</html>